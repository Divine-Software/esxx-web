<?xml version='1.0' encoding='UTF-8'?>

<!DOCTYPE page [
<!ENTITY % HTMLspecial SYSTEM "xhtml-special.ent">
<!ENTITY % HTMLlat1    SYSTEM "xhtml-lat1.ent">
<!ENTITY % HTMLsymbol  SYSTEM "xhtml-symbol.ent">

%HTMLspecial;
%HTMLlat1;
%HTMLsymbol;
]>

<page xmlns="http://www.w3.org/1999/xhtml" title="The friendly ECMAscript/XML Application Server">

<p>Welcome to ESXX, the free, easy-to-install, easy-to-use, no-nonsense
JavaScript/ECMAscript application server! ESXX is currenlty in 
<strong>alpha stage</strong>, which means that the APIs have not yet
completely stabilized; however, it's already quite usable and well worth
a try.</p>

<table summary="Donation options" style="text-align:center;">
<caption>Encourage futher development by making a donation!</caption>
<thead><tr>
<td>&euro; 10</td>
<td>&euro; 50</td>
<td>&euro; 100</td>
<td>&euro; 500</td>
<td>&euro; 1000</td>
<td>&euro; 5000</td>
</tr></thead>
<tbody><tr>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="8" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="2" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="40" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="10" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="80" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="20" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="400" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="100" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="800" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="200" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><div>
<input type="hidden" name="cmd" value="_xclick" />
<input type="hidden" name="business" value="martin@blom.org" />
<input type="hidden" name="item_name" value="ESXX" />
<input type="hidden" name="amount" value="4000" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="logo_custom" value="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" />
<input type="hidden" name="no_note" value="1" />
<input type="hidden" name="currency_code" value="EUR" />
<input type="hidden" name="tax" value="1000" />
<input type="hidden" name="lc" value="US" />
<input type="hidden" name="bn" value="PP-BuyNowBF" />
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!" />
<img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
</div></form>
</td>
</tr></tbody></table>

<p>Source code and binary packages, licensed under the GPL version 3 or
later, are available from the
<a href="http://developer.berlios.de/projects/esxx/">BerliOS</a> project
page.</p>


<h2>Introduction</h2>

<p>
<img src="/gfx/esxx-arch.png" alt="ESXX Architecture" style="float: right"/>
ESXX, pronounced <em>Essex</em>, is web application server that
executes web applications written in JavaScript (a.k.a. ECMAscript) on
the server-side. It's written in Java and has <i>no</i> external
dependencies except for J2SE 6.0 &mdash; everything else that's required
is packaged in one single, executable JAR file, ready to be tested in
Linux, OSX, Solaris, Windows or any other platform where Java 6 is
available.</p>

<p><em>Simplicity</em> does not have to mean <q>limiting</q>
or <q>incomplete</q>, though. Some of the highlights of ESXX are:</p>

<ul>
  <li><strong>JavaScript 1.7</strong>, provided by Rhino. Modern
JavaScript really is a fantastic language. We'll be tracking Rhino
releases, so expect 1.8 and 2.0 in the future.</li>
  <li><strong>E4X extensions</strong>, meaning unparallelled ease of use
when working with XML documents.</li>
  <li><strong>XSLT 2.0</strong>, provided by Saxon 9, for
state-of-the-art XML transformations with access to user-defined
JavaScript and Java extension functions directly from the XSLT
templates.</li>
  <li>Embedded <strong>SQL database</strong> (H2), for quick prototyping
or situations where a non-distributed web application is simply good
enough.</li>
  <li>Built-in <strong>web server</strong>, suitable for development and
small-scale deployments.</li>
  <li><strong>Secure by default</strong>: ESXX is designed to make the
applications immune to SQL injection or XSS attacks.
<a href="http://openfacts2.berlios.de/wikien/index.php/BerliosProject:ESXX_-_Security_advantages">More &hellip;</a></li>
  <li>Encourages <strong>layer separation</strong>
and <strong>state-less design</strong>, resulting in highly scalable,
easily maintainable web applications.</li>
  <li>Ready for the <strong>multi-core</strong> era: supports
multithreaded JavaScript applications with easy-to-use 
<strong>fork/join</strong> and <strong>parallel array</strong>
primitives.
<a href="http://openfacts2.berlios.de/wikien/index.php/BerliosProject:ESXX_-_ESXX#Methods">More &hellip;</a></li>
  <li>A <strong>RESTful mindset</strong> that encourages good-looking
URIs and exposes web services/resources, local files, LDAP directories
and SQL databases using the same API.</li>
  <li>Full access to <strong>J2SE 6</strong>: That's thousands of useful
classes and arguably one of the best runtime environments on the
planet. Naturally, you can plug in your own or 3rd party Java code too,
as well as native JNI modules.</li>
  <li>Remotely controllable via <strong>JMX</strong>: unload or view
statistics about running applications directly from
VisualVM or JConsole.</li>
  <li><strong>Standards-based</strong>: JavaScript, XML, XSLT, SQL, Java
&nbsp;&hellip; This is stuff you probably already know, so you'll be
productive in no time.</li>
</ul>

<p>Additionally, ESXX can be used to execute JavaScript <strong>script
files</strong> right from the command line. See below for a few
examples.</p>

<!--<p>For a more thorough introduction, please read the <q>Introducing
ESXX</q> paper.</p>-->


<h2>Quickstart</h2>

<p>Assuming you already have Java 6 installed:</p>

<ol>
<li>Download the ZIP archive.</li>
<li>Extract it and <kbd>cd</kbd> to the ESXX directoy in a console.</li>
<li>Start the built-in webserver on port 7777 by executing <kbd>java
-jar esxx.jar -H 7777</kbd>.</li>
<li>Point your web browser
to <a href="http://localhost:7777/">http://localhost:7777/</a> and run
some of the demo applications in the <var>examples</var> directory.</li>
<li>Shut down ESXX by pressing <kbd>Ctrl-C</kbd> in the console.</li>
</ol>

<p>Some of the demo applications will automatically create H2 SQL
databases in the current directory. They can be safely removed once ESXX
has been stopped.</p>


<h2>Examples</h2>

<p>Here are a few tiny examples that demonstrate a few key features of
ESXX. In order to be able to execute the script files from the command
line, you must have the RPM or DEB package installed. Otherwise,
use <kbd>java -jar esxx.jar -s &lt;script.js></kbd> to run them.</p>

<h3>load-uri.js</h3>

<p>Let's start with a command line example. Assume you would like to
fetch an URL and display the content of that URL as unparsed
text. Here's one way to do it. Invoke the script with <kbd>./load-uri.js
http://example.com</kbd>, for instance.</p>

<pre class="example">#!/usr/bin/env esxx-js

var err = java.lang.System.err;
var out = java.lang.System.out;

function main(prg, location) {
  if (!location) {
    err.println("Usage: " + prg + " &lt;location URI>");
    return 10;
  }

  var uri  = new URI(location);
  var data = uri.load("text/plain");

  out.println(data);
  return 0;
}</pre>

<p>The <var>URI</var> class is truly fundamental in ESXX. It's used to
read and write files, list directories, fetch and store web resources,
communicate with web services, look up information in LDAP directories,
query SQL databases, and more. In this example, <code>load()</code> is
used to fetch the resource, which is then parsed by the 
<var>text/plain</var> parser and returned as a JavaScript object (here,
a <var>String</var>). The <var>URI</var> class has four more
methods: <code>save()</code>, <code>append()</code>, <code>remove()</code>
and <code>query()</code>.</p>


<h3>last-sender.js</h3>

<p>Haven't you always wished you could find out who last sent you an
e-mail, without opening your mail program? I thought not. But let's
script the Java classes in JavaMail to find out.</p>

<pre class="example">#!/usr/bin/env esxx-js

importClass(java.lang.System);
importPackage(javax.mail);

function main(prg, location, username, password) {
  if (arguments.length &lt; 3) {
    System.err.println("Usage: " + prg + " &lt;IMAP URI> &lt;username> [&lt;password>]");
    return 10;
  }

  password = password || System.console().readPassword("Password: ");

  var session = Session.getDefaultInstance(System.getProperties());
  var store   = session.getStore(new URLName(location));

  store.connect(username, password);

  var inbox   = store.getFolder("INBOX");
  inbox.open(Folder.READ_ONLY);

  var message = inbox.getMessage(inbox.getMessageCount());

  System.out.println("Last message was from " + message.getSender());
  return 0;
}</pre>

<p>Execute the script with <kbd>./last-sender.js imaps://imap.gmail.com
&lt;username></kbd> and enter your password. My last mail was from a
spammer &mdash; who would have thought?</p>


<h3>wall.esxx</h3>

<p>I started with non-web examples for two reasons: First, I wanted to
demonstrate the <var>URI</var> class and how it can be used to access
external resources.  Second, it's important to point out that ESXX puts
no limitations on what you can do. If the minimalistic ESXX APIs does
not expose something you really need, you just script Java directly and
move on to the next programming task. (And before you go home for the
day, don't forget to file a feature request &mdash; or post a patch
&mdash; on the Berlios project page.)</p>

<p>Now, however, is the time to look at an ESXX web application. Do you
remember the early days of the web, when the coolest thing you could
have on your <q>home page</q> was something called a <q>guestbook</q>,
where your friends could write messages to you and read what others had
already written? Yeah, I know&nbsp;&hellip; Very novel. Let's get started.</p>

<pre class="example">&lt;?xml version="1.0" ?>

&lt;esxx xmlns="http://esxx.org/1.0/">
  &lt;handlers>
    &lt;http method="GET"  uri="/" handler="showMessages" />
    &lt;http method="POST" uri="/" handler="addMessage" />
    &lt;stylesheet href="wall.xslt" />
  &lt;/handlers>
&lt;/esxx>

&lt;?esxx
var db = new URI("jdbc:h2:mem:wall");

if (db.query("SELECT count(*) AS cnt " + 
	     "FROM information_schema.tables " +
	     "WHERE table_name = 'GUESTBOOK'").entry.cnt == 0) {
  db.query("CREATE TABLE GUESTBOOK (name VARCHAR(32), message CLOB, date DATETIME);");
  esxx.log.info("Created table GUESTBOOK");
}

function showMessages(req) {
  return &lt;wall>
    {db.query("SELECT name, message, date FROM GUESTBOOK LIMIT 10", { $result: "entries" })}
    &lt;form/>
  &lt;/wall>;
}

function addMessage(req) {
  if (!req.query.name || !req.query.message) {
    return &lt;wall>
      &lt;error>Name and message must be non-empty.&lt;/error>
      &lt;form>
        &lt;name>{req.query.name}&lt;/name>
        &lt;message>{req.query.message}&lt;/message>
      &lt;/form>
    &lt;/wall>;
  }

  db.query("INSERT INTO GUESTBOOK(name, message, date) VALUES({name}, {message}, NOW());",
	   req.query);
  esxx.log.info(req.query.name + " wrote: " + req.query.message);

  return [303, {Location: req.env.SCRIPT_NAME}];
}
?>
</pre>

<p>The entry point of an ESXX web application is an XML file that
defines the active URI, SOAP, XSLT and error handlers. Usually, this XML
file also contains a few <code>&lt;?esxx-include?></code> processing
instructions that loads the actual JavaScript code into memory. In this
example, we include the code directly in the XML file
using <code>&lt;?esxx?></code>, but that's something you would normally
  never do.</p>

<p>In the example, we define two <code>GET</code> and <code>POST</code>
handlers, <code>showMessages()</code> and <code>addMessage()</code>, and
an <a href="wall.xslt">XSLT stylesheet</a> that will be triggered by all
XML results.</p>

<p>The handlers can return different kinds of data, like plain text,
binary data, Java image objects, or XML. When a handler returns XML
data, XSLT stylesheet processing is enabled and if there is a matching
stylesheet registered, the result will be transformed accordingly.</p>

<p>Knowing this, it's easy to understand how <var>wall.esxx</var>
works:</p>

<ol>
  <li>At application load time, the global variable <var>db</var> is
initialized to the location of an in-memory H2 SQL database. Then, a
test query is run to find out if the table <var>GUESTBOOK</var> exists;
if not, it's created. Code in the global scope is only executed
once during the application's lifetime.</li>
  <li>After that, the application begins waiting for requests. When
a <code>GET</code> request arrives, <code>getMessages()</code> will
return an XML document. This document includes everything that is to be
presented to the user, including a list of messages fetched from the
database. The <code>&lt;form></code> element signals that the stylesheet
should also render an HTML form, where the user can enter a
message.</li>
  <li>Once the response has been returned
from <code>getMessages()</code>, the result is transformed into HTML by
the XSLT stylesheet. The final document will contain an HTML form where
new messages can be entered. Have a look at <a href="wall.xslt">the
stylesheet</a> to see how it's done.</li>
  <li>If a message is entered and the user presses the submit button,
the <code>POST</code> request will trigger the <code>addMessage()</code>
handler. This function validates the form parameters and either
    <ol style="list-style-type: lower-roman;"> 
      <li> returns an error message; or</li>
      <li>adds the message to the in-memory SQL database and
	redirects the user back to the <code>GET</code> view.</li>
  </ol></li>
</ol>

<p>And that's all there is to that: one SQL database, one XSLT
stylesheet and a few lines of JavaScript. Model, view,
controller. Simple, eh? No auto-generated files, no wizards, no magic
and no bloat. I find it reassuring that trivial web applications can
still be trivial to write. (Needless to say, all user input is encoded
appropriately, both in the generated HTML document and in the
database. Try it!)</p>


<h2>What it's not</h2>

<p>ESXX is a small runtime for JavaScript web applications, mainly
intended as a PHP alternative (or, on the small scale, a J2EE
alternative &mdash; web apps do not <em>have</em> to be big and
complicated!). It's not a web application framework, although you could
certainly write one for it.  Specifically:</p>

<ul>
<li>There is no automatic request filter chain processing: you're
expected to delegate the processing yourself.</li>
<li>There is no object-relational mapper. (Frankly, I don't believe in
O/R mapping.)</li>
<li>There is no automatic session handling or <q>continuations</q>
support. Sessions and saved state limit scalability and should be dealt
with explicitly, when required. Session handling in ESXX is trivial,
anyway.</li>
</ul>

<p>But remember, just because something is not directly available in the
ESXX executable, it doesn't mean it couldn't, or shouldn't, be written
as a JavaScript framework!</p>

<p><a href="rationale.html">More &hellip;</a></p>


<h2>My eyes hurt!</h2>

<p>While advanced and using lots of the latest technoligies available,
ESXX is also retro in many ways, so it was only fitting to use a theme
that was state of the art in the 80's. Use the links below to switch
style.</p>

</page>
